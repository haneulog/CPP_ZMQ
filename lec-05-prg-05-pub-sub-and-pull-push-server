#include <zmq.hpp>
#include <string>
#include <iostream>

int main(){
  zmq::context_t con(1);
  zmq::socket_t publisher(con, ZMQ_PUB);
  publisher.bind("tcp://*:5557");
  zmq::socket_t collector(con, ZMQ_PULL);
  collector.bind("tcp://*:5558");

  while (true) {
    zmq::message_t msg;
    collector.recv(msg, zmq::recv_flags::none);
    std::string remsg(static_cast<char*>(msg.data()), msg.size());
    std::cout << "I: publishing update " << remsg << std::endl;
    publisher.send(msg, zmq::send_flags::none);
  }
  return 0;
}
